include ../.layout.jade

doctype html
html(lang=gw.language)
	- var path = [{label:'Pillars.js Tutorials',url:'/pillars/docs/tutorials/'},{label:'Cliente-Servidor',url:'/pillars/docs/tutorials/client-server.jade'}];
	+tutorials-layout("Pillars.js Tutorials - Petición HTTP - 'make it easy!'",path)

		#title
			h1 Métodos de petición
				em  Pillars.js Tutorials
		

		//- Summary
		section.summary
			h2#summary Sumario
			:marked
				El protocolo HTTP define 8 métodos de petición: HEAD, GET, POST, PUT, DELETE, TRACE, OPTIONS Y CONNECT, todos están soportados por Pillars.js. En este tutorial vamos a ver dos formas de enviar datos del cliente al servidor: 

				+ Query String. *(El conocido GET)*
				+ Contenido de la solicitud. *(El conocido POST)*
				
				> Más información [8 métodos de petición del Protocolo HTTP](http://es.wikipedia.org/wiki/Hypertext_Transfer_Protocol#M.C3.A9todos_de_petici.C3.B3n).

				Además, el framework permite el uso de rutas parametrizadas, que veremos en el último apartado. 



		//- Examples
		section.example-01
			h2#example-01 Query String

			
			:marked
				Query string es todo aquello que, desde el cliente, se ejecute después de la url con el formato: *interrogación*, *variable* *igual a valor*. Ejemplo: *?q=1*.
				
				Estos datos los encontramos en gangway, en la [propiedad gw.query](../reference/gangway.jade#property-query).
				

			:highlight(lang='javascript')
				let project = require("pillars");

				project.services.get("http").start();

				project.routes.add(new Route(function(gw){					
					gw.send("Has enviado mediante Query String el valor: " + gw.query['q']);
				}));

				// Se visita http://localhost/?q=1
				//> Has enviado mediante Query String el valor: 1
				// gw.query contiene un objeto:  { q: '1' }
				


		//- Examples
		section.example-02
			h2#example-02 Contenido de la solicitud

			:marked
				Para que un controlador pueda recibir un formulario mediante el método POST, éste debe estar configurado en su `method`, aunque recuerda que en principio el valor de `method` es *undefined*, por lo que acepta cualquier método de petición. Además si va a aceptar ficheros, `multipart` debe estar seteada a **true**.

				Cuando se envía al servidor un formulario por el método POST, los datos los podemos tomar de [gw.content.params](../reference/gangway.jade#property-content). 

			:highlight(lang='javascript')
				let project = require("pillars");

				project.services.get("http").start();

				project.routes.add({
					method: "POST",
					multipart: true
				},new Route(function(gw){
					gw.content.params
					gw.files
					¿Dónde están físicamente?
					gw.send("Has enviado mediante Query String el valor: " + gw.query['q']);
				}));


		//- Examples
		section.example-03
			h2#example-03 Rutas parametrizadas

			:marked
				Cuando declaramos un objeto route, uno de los parámetros de la configuración es el path. Éste admite varias formas de configuración, que son las siguientes: 
				
				**1)** Ruta del Path a secas. *path:'pathestatico'*. Esta es la forma habitual en la que hemos declarado los path en los ejemplos.
				

				**2)** Una o varias variables definidas. *path:'/:var'* para una variable, o *path:'/:var1/:var2'* para varias variables.
			
			:highlight(lang='javascript')
				addRoute({path:'/:var'},function(gw){
					gw.send(gw.pathParams['var']);
				});
				// http://localhost/hola , devuelve 'hola'
				// http://localhost/users , devuelve 'users'

				addRoute({path:'/:var1/:var2'},function(gw){
					gw.send("var1: "+ gw.pathParams['var1']+", var2: "+gw.pathParams['var2'] );
				});
				// http://localhost/hola/maria , devuelve var1: hola, var2:maria
				// http://localhost/users/juan , devuelve var1: users, var2:juan,

				
			:marked
				**3)** Variables sin definir en número. *path: '/*:var'*
				
			:highlight(lang='javascript')
				addRoute({path:'/*:var'},function(gw){
					gw.send(gw.pathParams['var']);
				});
				// http://localhost/hola , devuelve 'hola'
				// http://localhost/users/juan , devuelve 'users/juan'
				// http://localhost/users/juan/fotos , devuelve 'users/juan/fotos'

			:marked
				Para finalizar, un ejemplo de combinación de las tres rutas parametrizadas en un mismo path: 

			:highlight(lang='javascript')
				addRoute({path:'/users/:user/:dir/*:resto'},function(gw){
					gw.send("user: "+ gw.pathParams['user']+", dir: "+gw.pathParams['dir']+
						", resto: "+gw.pathParams['resto']);
				});
				// http://localhost/users/juan/fotos/2014/album1 , 
				// devuelve 'user: juan, dir: fotos, resto: 2014/album1'
			


				



		

